# III - Serveur DNS esclave faisant autorit√©


![](../../../media/logo-cub.png)

## Pr√©requis

![](../../../media/schema-logique-cub.png)

*Ducumentation en ligne : [https://cubdocumentation.sioplc.fr](https://cubdocumentation.sioplc.fr)*
<br>

## Adressage 

| Puissance de 2 | Valeur |
|:---------------:|:------:|
| 2‚Å∞ | 1 |
| 2¬π | 2 |
| 2¬≤ | 4 |
| 2¬≥ | 8 |
| 2‚Å¥ | 16 |
| 2‚Åµ | 32 |
| 2‚Å∂ | 64 |
| <span style="background-color:#aee7ff; padding:2px 4px; border-radius:3px;">**2‚Å∑**</span> | <span style="background-color:#aee7ff; padding:2px 4px; border-radius:3px;">**128**</span> |

**Adresse r√©seau : 192.168.6.0/24**

<br>

| **Service** | **Nombre d‚Äôh√¥tes** | **Adresse r√©seau** | **Masque de sous-r√©seau** | **Adresse de diffusion** | **Description VLAN** |
|--------------|--------------------:|--------------------|----------------------------|---------------------------|----------------------|
| Production | 120 | 192.168.6.0 | <span style="background-color:#b7fbb7;">255.255.255.128</span> | 192.168.6.127 | VLAN 56 |
| Client 1 | 32 | 192.168.6.128 | 255.255.255.192 | 192.168.6.191 | VLAN 10 |
| Administration syst√®mes et r√©seaux | 6 | 192.168.6.192 | 255.255.255.240 | 192.168.6.207 | VLAN 20 |

<br>

**N¬∞1 sous-r√©seau Production = 126 h√¥tes ‚Üí** <span style="background-color:#aee7ff; padding:2px 4px; border-radius:3px;">**2‚Å∑**</span> **‚Üí <span style="background-color:#b7fbb7;">/25**</span>

**Production = 192.168.6.0/24 ‚Üí 255.255.255.128 ‚Üí** <span style="background-color:#aee7ff; padding:2px 4px; border-radius:3px;">**x.x.x.1000 0000**</span>

**Diffusion :** `1100 0000 . 1010 1000 . 0000 0110 . 0111 1111`  
‚û°Ô∏è 192.168.6.**127**

___

## Sch√©ma logique ‚Äì Agence Frankfur

![](../../../media/bloc2/ExploitationServ/Activite0-1.png)

___
## Packet tracert - Agence Frankfurt
<br>

![](../../../media/packet-tracert-v1.jpg)
<br>

<div style="text-align:center; margin-top:20px;">
  <a href="https://drive.google.com/file/d/1L7Gp52YpPjjRhFdp9gp4L1sGORqAoCEK/view?usp=share_link" 
     style="display:inline-block;
            background:#e7e7e9;
            color:#0096FF;
            padding:11px 25px;
            border-radius:10px;
            text-decoration:none;
            font-weight:50;
            box-shadow:0 0 12px rgba(0,0,0,0.5);
            transition:all 0.3s ease;"
     onmouseover="this.style.background='#dcdce0'; this.style.color='#003d80';"
     onmouseout="this.style.background='#e7e7e9'; this.style.color='#0096FF';">
     üîó Cliquer pour t√©l√©cherger le paket tracert
  </a>
</div>
<br>

___

## Plan de c√¢blage 

![](../../../media/bloc2/ExploitationServ/Activite0-2.png)

___

!!! note "Information sur le contexte"
    Manipulation et documentation r√©aliser par mon Bin√¥me **Joris TEXIER**

**V√©rification pr√©alable**

```bash
sudo apt update && sudo apt upgrade
sudo apt install rsyslog bind9 dnsutils
```

**Param√®tres r√©seaux**

```bash
sudoedit /etc/network/interfaces
sudoedit /etc/resolv.conf
nameserver 9.9.9.9
sudo systemctl restart networking
```

![](../../../media/bloc2/ExploitationServ/Activite1-18.png)

**Configuration des fichiers d'identit√©**

```bash
sudoedit /etc/hostname
ns1
sudoedit /etc/hosts
sudo shutdown -r now
```
![](../../../media/bloc2/ExploitationServ/Activite1-19.png)

**Exemple de configuration Bind9 (esclave)**
```bash
sudoedit /etc/bind/named.conf.local
sudo touch /var/cache/bind/db.frankfurt.cub.sioplc.fr
sudo chown bind:bind /var/cache/bind/db.frankfurt.cub.sioplc.fr
```
![](../../../media/bloc2/ExploitationServ/Activite1-20.png)

**Mise en place de la journalisation**
```bash
sudoedit /etc/bind/named.conf.log
sudo touch /var/log/bind.log
sudo chown bind:bind /var/log/bind.log
sudoedit /etc/bind/named.conf
```
![](../../../media/bloc2/ExploitationServ/Activite1-21.png)
![](../../../media/bloc2/ExploitationServ/Activite1-22.png)

Configuration AppArmor :

```bash
sudoedit /etc/apparmor.d/usr.sbin.named
# Autoriser le daemon Bind 9 √† lire et √©crire dans /var/log/bind.log
/var/log/bind.log rw,
sudo apparmor_parser -r /etc/apparmor.d/local/usr.sbin.named
sudo systemctl restart apparmor
sudo named-checkconf -z
sudo systemctl restart bind9
sudo systemctl status bind9
```

![](../../../media/bloc2/ExploitationServ/Activite1-23.png)

**TEST**

Cette commande permet de tester la r√©solution DNS d‚Äôun domaine pr√©cis :

```bash
nslookup ns0.frankfurt.cub.sioplc.fr 192.36.6.10
```
R√©sultat attendu : - `ns0.frankfurt.cub.sioplc.fr` ‚Üí `192.36.6.11` (esclave) - `ns1.frankfurt.cub.sioplc.fr` ‚Üí `192.36.6.10` (ma√Ætre)

![](../../../media/bloc2/ExploitationServ/Activite1-24.png)
![](../../../media/bloc2/ExploitationServ/Activite1-25.png)
